<!DOCTYPE html>
<html lang="zh-tw">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>[台灣杉] 一鍵登入國網中心台灣杉(Taiwania) - 世情如紙</title>
  
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3218529224055685" crossorigin="anonymous"></script>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="tigernaxo" /><meta name="description" content="台灣杉(Taiwania)是國網中心2018年啟用的超級電腦，登入時密碼必須附加OTP (One-time Password)，國網中心建議取得OTP的方式是從" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.86.0 with theme even" />


<link rel="canonical" href="https://blogger.tigernaxo.com/post/biotech/taiwania_login_oneclick/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.7396874585fdfc06299136a30095f9cf3555527c842521c6641c0166e66e369d.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/peter.css">


<meta property="og:title" content="[台灣杉] 一鍵登入國網中心台灣杉(Taiwania)" />
<meta property="og:description" content="台灣杉(Taiwania)是國網中心2018年啟用的超級電腦，登入時密碼必須附加OTP (One-time Password)，國網中心建議取得OTP的方式是從" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blogger.tigernaxo.com/post/biotech/taiwania_login_oneclick/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2019-01-23T09:37:18+08:00" />
<meta property="article:modified_time" content="2019-01-23T09:37:18+08:00" />

<meta itemprop="name" content="[台灣杉] 一鍵登入國網中心台灣杉(Taiwania)">
<meta itemprop="description" content="台灣杉(Taiwania)是國網中心2018年啟用的超級電腦，登入時密碼必須附加OTP (One-time Password)，國網中心建議取得OTP的方式是從"><meta itemprop="datePublished" content="2019-01-23T09:37:18+08:00" />
<meta itemprop="dateModified" content="2019-01-23T09:37:18+08:00" />
<meta itemprop="wordCount" content="4556">
<meta itemprop="keywords" content="台灣杉," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[台灣杉] 一鍵登入國網中心台灣杉(Taiwania)"/>
<meta name="twitter:description" content="台灣杉(Taiwania)是國網中心2018年啟用的超級電腦，登入時密碼必須附加OTP (One-time Password)，國網中心建議取得OTP的方式是從"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Naxo</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Naxo</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-3218529224055685"
     data-ad-slot="6458976577"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">[台灣杉] 一鍵登入國網中心台灣杉(Taiwania)</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-01-23 </span>
        <div class="post-category">
            <a href="/categories/biotech/"> Biotech </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目錄</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#注意事項">注意事項</a></li>
    <li><a href="#從windows登入台灣杉">從Windows登入台灣杉</a>
      <ul>
        <li><a href="#前置工作">前置工作</a></li>
        <li><a href="#編譯totp產生器">編譯TOTP產生器</a></li>
        <li><a href="#設置putty">設置putty</a></li>
        <li><a href="#撰寫批次檔-串聯totp產生器與putty-session">撰寫批次檔 (串聯TOTP產生器與putty session)</a></li>
        <li><a href="#撰寫批次檔-串聯totp產生器與winscp">撰寫批次檔 (串聯TOTP產生器與WinSCP)</a></li>
        <li><a href="#測試">測試</a></li>
      </ul>
    </li>
    <li><a href="#從linux具有管理員權限登入台灣杉">從Linux(具有管理員權限)登入台灣杉</a>
      <ul>
        <li><a href="#安裝oathtoolsshpass">安裝oathtool、sshpass</a></li>
        <li><a href="#設置腳本logintaiwaniash">設置腳本loginTaiwania.sh</a></li>
        <li><a href="#予登入腳本執行權限">予登入腳本執行權限</a></li>
        <li><a href="#測試登入">測試登入</a></li>
      </ul>
    </li>
    <li><a href="#從linux沒有管理員權限登入台灣杉">從Linux(沒有管理員權限)登入台灣杉</a>
      <ul>
        <li><a href="#確認sshpassoathtool">確認sshpass、oathtool</a></li>
        <li><a href="#編譯sshpass">編譯sshpass</a></li>
        <li><a href="#編譯otp產生器oathtool替代方案">編譯OTP產生器(oathtool替代方案)</a></li>
        <li><a href="#設置腳本logintaiwaniash-1">設置腳本loginTaiwania.sh。</a></li>
        <li><a href="#測試登入-1">測試登入</a></li>
      </ul>
    </li>
    <li><a href="#附錄在沒有權限的主機上使用oathtool-練習抽取package滿足相依性">附錄：在沒有權限的主機上使用oathtool (練習抽取package、滿足相依性)</a>
      <ul>
        <li><a href="#rpmredhatcentosfedora系統">rpm(RedHat/CentOS/Fedora)系統</a></li>
        <li><a href="#aptdebianubuntu系統">apt(Debian/Ubuntu)系統</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>台灣杉(Taiwania)是國網中心2018年啟用的超級電腦，登入時密碼必須附加OTP (One-time Password)，國網中心建議取得OTP的方式是從驗證器取得OTP密碼，但這樣的方式每次都需要打開驗證器(手機、chrome插件… etc)，並且需要手動輸入OTP，下面分享我從Windows以及Linux環境下登入台灣杉所使用的一鍵登入方式。</p>
<p>OTP的演算法可粗分為HOTP (HMAC-based OTP)；以及基於HOTP的TOTP (Time-based OTP)，我們不必瞭解演算法細節，只需知道台灣杉採用Base32編碼作為TOTP金鑰(Secret)，時間間格為30秒，每30秒可以根據”Secret”與”當前時間區間”以sha1演算法生成一次性密碼(OTP，或稱為Key)，由於這是單向加密的過程所以無法用時間區間與Key逆推Secret，並且OTP在成功使用一次之後就會被伺服器廢棄，以確保安全性。</p>
<h1 id="注意事項">注意事項</h1>
<ul>
<li><strong>校時</strong><br>
由於TOTP演算法依據當前時間區間產生OTP，如果作業系統的時間不正確則會產生錯誤的OTP，在Windows環境之下可以到國家時間與頻率標準實驗室的網頁下載NTP校時軟體，以管理員身分執行進行校時；Linux環境可以用下述指令更新時間並寫入BIOS：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 從NTP時間伺服器進行網路校時</span>
sudo ntpdate time.stdtime.gov.tw
<span class="c1"># 將更新的時間寫入BIOS</span>
sudo hwclock -w
</code></pre></td></tr></table>
</div>
</div></li>
<li><strong>所有登入行為之間必須間隔30秒(包含使用winSCP、putty或從Linux直接登入)。</strong>
每個30秒區間會產生一個OTP，而該OTP一旦經過使用就會被伺服器廢棄而無法再用。我曾經連續登入以為程式壞了，但核對iService上面產生的密碼又是一樣的，後來才發現這件事…中間還因為連登失敗太頻繁還被鎖，因此記得間隔30秒以上再登入。</li>
<li><strong>Linux要登入台灣衫需要將台灣衫加入know host</strong>，以生醫節點為例:
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ssh-keyscan 140.110.148.14 1&gt;&gt;~/.ssh/known_hosts 2&gt;/dev/null
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h1 id="從windows登入台灣杉">從Windows登入台灣杉</h1>
<h2 id="前置工作">前置工作</h2>
<ul>
<li>安裝<a href="https://golang.org/dl/">Go</a>，並<a href="https://github.com/golang/go/wiki/SettingGOPATH">設置GOPATH</a>。</li>
<li>安裝<a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">putty</a>。</li>
<li>安裝<a href="https://winscp.net/eng/download.php">WinSCP</a>。</li>
<li>知道怎麼打開windows的命令提示字元 (WIN+R、鍵入cmd、enter)。</li>
</ul>
<h2 id="編譯totp產生器">編譯TOTP產生器</h2>
<p>取得TOTP套件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bat" data-lang="bat">go get github.com/pquerna/otp/totp
</code></pre></td></tr></table>
</div>
</div><p>撰寫程式碼main.go</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
        <span class="s">&#34;fmt&#34;</span>
        <span class="s">&#34;github.com/pquerna/otp/totp&#34;</span>
        <span class="s">&#34;os&#34;</span>
        <span class="s">&#34;time&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">secret</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="nx">code</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">totp</span><span class="p">.</span><span class="nf">GenerateCode</span><span class="p">(</span><span class="nx">secret</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">UTC</span><span class="p">())</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>編譯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bat" data-lang="bat">go build -o taiwaniaOTP.exe main.go
</code></pre></td></tr></table>
</div>
</div><h2 id="設置putty">設置putty</h2>
<p>按照圖片步驟設置putty session，如果不想修改預設字型可跳過步驟4~6，全部設置完成後要回Session標籤按Save(步驟7、8)
<img src="set-putty-session.jpg" alt="設置Putty Session"></p>
<h2 id="撰寫批次檔-串聯totp產生器與putty-session">撰寫批次檔 (串聯TOTP產生器與putty session)</h2>
<p>建立資料夾(例如: D:\BioPkg\taiwania)，把剛剛的taiwaniaOTP.exe丟進去，在資料夾內複製下面指令建立taiwania-putty.bat批次檔，按照步驟1~3進行設置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bat" data-lang="bat"><span class="p">@</span><span class="k">echo</span> off
<span class="p">:</span><span class="c1">: 1.設置putty執行檔位置</span>
<span class="k">SET</span> <span class="nv">putty</span><span class="p">=</span>D:\Programs\putty.exe
<span class="p">:</span><span class="c1">: 2.設置固定密碼(取代password)</span>
<span class="k">SET</span> <span class="nv">regular_pw</span><span class="p">=</span>password
<span class="p">:</span><span class="c1">: 3.設置TOTP金鑰(從iservice服務網複製的金鑰取代TOTPsecret)</span>
<span class="k">SET</span> <span class="nv">secret</span><span class="p">=</span>TOTPsecret

<span class="p">:</span><span class="c1">: 取得totp</span>
<span class="k">for</span> <span class="k">/f</span> <span class="se">%%</span>i <span class="k">in</span> <span class="p">(</span><span class="s1">&#39;</span><span class="nv">%cd%</span><span class="s1">/taiwaniaOTP.exe </span><span class="nv">%secret%</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="k">set</span> <span class="nv">totp</span><span class="p">=</span><span class="se">%%</span>i

<span class="p">:</span><span class="c1">: 5.把taiwania-14取代成你剛剛設置的session name</span>
<span class="k">start</span> D:\Programs\putty.exe -load <span class="s2">&#34;taiwania-14&#34;</span> -pw <span class="nv">%regular_pw%%totp%</span>
<span class="k">exit</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="撰寫批次檔-串聯totp產生器與winscp">撰寫批次檔 (串聯TOTP產生器與WinSCP)</h2>
<p>在資料夾內複製下面指令建立taiwania-sftp.bat，按照步驟1~4設置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bat" data-lang="bat"><span class="p">@</span><span class="k">echo</span> off
<span class="p">:</span><span class="c1">: 1.設置WinSCP執行檔位置</span>
<span class="k">SET</span> <span class="nv">winSCP</span><span class="p">=</span><span class="s2">&#34;C:\Program Files (x86)\WinSCP\WinSCP.exe&#34;</span>
<span class="p">:</span><span class="c1">: 2.設置使用者名稱(取代userName)</span>
<span class="k">SET</span> <span class="nv">user</span><span class="p">=</span>userName
<span class="p">:</span><span class="c1">: 3.設置固定密碼(取代password)</span>
<span class="k">SET</span> <span class="nv">regular_pw</span><span class="p">=</span>password
<span class="p">:</span><span class="c1">: 4.設置TOTP金鑰(從iservice服務網複製的金鑰取代TOTPsecret)</span>
<span class="k">SET</span> <span class="nv">secret</span><span class="p">=</span>TOTPsecret

<span class="p">:</span><span class="c1">: 取得totp</span>
<span class="k">for</span> <span class="k">/f</span> <span class="se">%%</span>i <span class="k">in</span> <span class="p">(</span><span class="s1">&#39;</span><span class="nv">%cd%</span><span class="s1">/taiwaniaOTP.exe </span><span class="nv">%secret%</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="k">set</span> <span class="nv">totp</span><span class="p">=</span><span class="se">%%</span>i

<span class="p">:</span><span class="c1">: 呼叫winSCP登入台灣杉資料傳輸專用節點</span>
<span class="k">start</span> <span class="nv">%winSCP%</span> sftp://<span class="nv">%user%</span>:<span class="nv">%regular_pw%%totp%</span>@140.110.148.21:22
<span class="k">exit</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="測試">測試</h2>
<p>目前為止我們完成了兩件事，接下來我們一分鐘的安全間隔進行測試，你可以在桌面上建立批次檔的捷徑方便登入，甚至是改icon讓它們更像一回事：</p>
<ul>
<li>雙擊taiwania-putty.bat呼叫putty session登入台灣杉生醫節點(140.110.148.14)。</li>
<li>雙擊taiwania-sftp.bat呼叫winSCP登入台灣杉的資料傳輸節點(140.110.148.21)。</li>
</ul>
<h1 id="從linux具有管理員權限登入台灣杉">從Linux(具有管理員權限)登入台灣杉</h1>
<p>使用Linux的設定自動登入需要熟悉基本Linux操作(套件安裝、環境變數、shell script)，或是嘗試按照下列步驟設定，當然您也可以自行編譯上述的OTP產生器(從Windows登入小節所提到)取代oathtool：</p>
<h2 id="安裝oathtoolsshpass">安裝oathtool、sshpass</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 如果系統為Red Hat/CentOs/Fedora則改用yum</span>
sudo apt-get update
sudo apt-get install oathtool sshpass
</code></pre></td></tr></table>
</div>
</div><h2 id="設置腳本logintaiwaniash">設置腳本loginTaiwania.sh</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1">##### loginTaiwania.sh #####</span>
<span class="c1">#!/bin/bash</span>
<span class="nv">secret</span><span class="o">=</span><span class="s2">&#34;Enter-Your-Otp-Secret-Got-From-Nchc&#34;</span>
<span class="nv">taiwaniaIP</span><span class="o">=</span><span class="s2">&#34;140.110.148.14&#34;</span>
<span class="nv">userName</span><span class="o">=</span><span class="s2">&#34;Enter-Your-Id-On-Taiwania&#34;</span>
<span class="nv">fixedPW</span><span class="o">=</span><span class="s2">&#34;Enter-Your-Fixed-Password&#34;</span>
<span class="nv">otp</span><span class="o">=</span><span class="k">$(</span>oathtool -b -d6 -s30 --totp<span class="o">=</span><span class="s2">&#34;sha1&#34;</span> <span class="si">${</span><span class="nv">secret</span><span class="si">}</span><span class="k">)</span>
sshpass -p <span class="si">${</span><span class="nv">fixedPW</span><span class="si">}${</span><span class="nv">otp</span><span class="si">}</span> ssh <span class="si">${</span><span class="nv">userName</span><span class="si">}</span>@<span class="si">${</span><span class="nv">taiwaniaIP</span><span class="si">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="予登入腳本執行權限">予登入腳本執行權限</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">chmod a+x loginTaiwania.sh
</code></pre></td></tr></table>
</div>
</div><h2 id="測試登入">測試登入</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">./loginTaiwania.sh
</code></pre></td></tr></table>
</div>
</div><h1 id="從linux沒有管理員權限登入台灣杉">從Linux(沒有管理員權限)登入台灣杉</h1>
<p>有時候會用使用其他機器登入台灣杉，但是卻沒有管理員權限可以安裝sshpass、oathtool，以下是變通方法。</p>
<h2 id="確認sshpassoathtool">確認sshpass、oathtool</h2>
<p>查詢系統是否提供sshpass、oathtool，如果已有可以省略編譯的步驟，下面在台灣杉上查詢的結果顯示PATH中有sshpass但找不到oathtool，所以在台灣杉上可以跳過編譯sshpass的步驟。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ which sshpass
/usr/bin/sshpass
$ which oathtool
/usr/bin/which: no oathtool in <span class="o">(</span>/home/ux/xxx/bin:/home/xxx/bin:/cm/local/apps/gcc/6.3.0/bin:/usr/lib64/qt-3.3/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/usr/sbin:/cm/local/apps/environment-modules/3.2.10/bin:/opt/pbs/bin:/usr/bin:/usr/bin:/home/xxx/.local/bin:/home/xxx/bin<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="編譯sshpass">編譯sshpass</h2>
<p>最後sshpass的可執行檔預期是/path/to/sshpass-1.06/sshpass。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">$ wget http://sourceforge.net/projects/sshpass/files/latest/download -O sshpass.tgz
$ tar zxf sshpass.tgz
$ cd sshpass-1.06
$ ./configure &amp;&amp; make
$ /path/to/sshpass-1.06/sshpass
Usage: sshpass [-f|-d|-p|-e] [-hV] command parameters
   -f filename   Take password to use from file
   -d number     Use number as file descriptor for getting password
   -p password   Provide password as argument (security unwise)
   -e            Password is passed as env-var &#34;SSHPASS&#34;
   With no parameters - password will be taken from stdin

   -P prompt     Which string should sshpass search for to detect a password prompt
   -v            Be verbose about what you&#39;re doing
   -h            Show help (this screen)
   -V            Print version information
At most one of -f, -d, -p or -e should be used
</code></pre></td></tr></table>
</div>
</div><h2 id="編譯otp產生器oathtool替代方案">編譯OTP產生器(oathtool替代方案)</h2>
<p>要在像台灣杉類似的主機上編譯oathtool有點複雜，如果一定要用oathtool比較可行的方法是下載binary及so(參考附錄)，但最簡單的方法還是直接編譯自己的OTP產生器，這一步需要先安裝<a href="https://golang.org/dl/">Go</a>，並及設置<a href="https://github.com/golang/go/wiki/SettingGOPATH">GOPATH</a>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">go get github.com/pquerna/otp/totp
</code></pre></td></tr></table>
</div>
</div><p>撰寫TOTP產生器 main.go</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
        <span class="s">&#34;fmt&#34;</span>
        <span class="s">&#34;github.com/pquerna/otp/totp&#34;</span>
        <span class="s">&#34;os&#34;</span>
        <span class="s">&#34;time&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">secret</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="nx">code</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">totp</span><span class="p">.</span><span class="nf">GenerateCode</span><span class="p">(</span><span class="nx">secret</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">UTC</span><span class="p">())</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>編譯TOTP產生器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">go build -o taiwaniaOTP main.go
</code></pre></td></tr></table>
</div>
</div><h2 id="設置腳本logintaiwaniash-1">設置腳本loginTaiwania.sh。</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span><span class="nv">secret</span><span class="o">=</span><span class="s2">&#34;Enter-Your-Otp-Secret-Got-From-Nchc&#34;</span>
<span class="nv">taiwaniaIP</span><span class="o">=</span><span class="s2">&#34;140.110.148.14&#34;</span>
<span class="nv">userName</span><span class="o">=</span><span class="s2">&#34;Enter-Your-Id-On-Taiwania&#34;</span>
<span class="nv">fixedPW</span><span class="o">=</span><span class="s2">&#34;Enter-Your-Fixed-Password&#34;</span>
<span class="c1"># 如果系統本身有提供oathtool，就把taiwaniaOTP改成oathtool</span>
<span class="nv">otp</span><span class="o">=</span><span class="k">$(</span>taiwaniaOTP <span class="si">${</span><span class="nv">secret</span><span class="si">}</span><span class="k">)</span>
sshpass -p <span class="si">${</span><span class="nv">fixedPW</span><span class="si">}${</span><span class="nv">otp</span><span class="si">}</span> ssh <span class="si">${</span><span class="nv">userName</span><span class="si">}</span>@<span class="si">${</span><span class="nv">taiwaniaIP</span><span class="si">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="測試登入-1">測試登入</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"> ./loginTaiwania.sh
</code></pre></td></tr></table>
</div>
</div><h1 id="附錄在沒有權限的主機上使用oathtool-練習抽取package滿足相依性">附錄：在沒有權限的主機上使用oathtool (練習抽取package、滿足相依性)</h1>
<p>如果要在沒有權限的主機上使用oathtool，就得要自己下載rpm/deb，從裡面抽取binaries及Requires，下面分成rpm(RedHat/CentOS/Fedora)跟apt(Debian/Ubuntu)系統說明：</p>
<h2 id="rpmredhatcentosfedora系統">rpm(RedHat/CentOS/Fedora)系統</h2>
<p>查詢OS版本資訊，得知台灣衫的OS是Red Hat 7.3。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">$ lsb_release -d
Description:    Red Hat Enterprise Linux Server release 7.3 (Maipo)
</code></pre></td></tr></table>
</div>
</div><p>到<a href="https://pkgs.org/download">pkgs.org</a>找相應的Binary Package rpm版本，我們點選CentOS 7的EPEL x86_64版本oathtool-2.4.1-9.el7.x86_64.rpm ( CentOS與Red Hat是相容的，EPEL代表Extra Packages for Enterprise Linux，rpm套件管理員當中描述的x86_64是指cpu的x86-64架構，雖然有伺服器已經開始採用較省電的ARM架構，但目前幾乎所有的伺服器架構都是x86-64 )，接著在Download底下取得Binary Package的下載連結，以下面的指令下載、展開、確認相依性：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"># 下載Binary Package
$ wget http://download-ib01.fedoraproject.org/pub/epel/7/x86_64/Packages/o/oathtool-2.4.1-9.el7.x86_64.rpm
# 抽取Binary Package
$ rpm2cpio oathtool-2.4.1-9.el7.x86_64.rpm | cpio -ivd
./usr/bin/oathtool
./usr/share/doc/oathtool-2.4.1
./usr/share/doc/oathtool-2.4.1/COPYING
./usr/share/man/man1/oathtool.1.gz
165 blocks
# 查看oathtool相依性，not found標註代表相依性未滿足
$ ldd ./usr/bin/oathtool
        linux-vdso.so.1 =&gt;  (0x00002aaaaaaab000)
        liboath.so.0 =&gt; not found
        libc.so.6 =&gt; /lib64/libc.so.6 (0x00002aaaaaad4000)
        /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
</code></pre></td></tr></table>
</div>
</div><p>下載oathtool未滿足的相依性，可以直接到剛剛取得下載連結的下載頁面，從Requires欄位下直接點選項目liboath.so.0()(64bit)的連結，一樣選擇CentOS 7的EPEL x86_64版本下載</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"># 下載Binary Package
$ wget http://download-ib01.fedoraproject.org/pub/epel/7/x86_64/Packages/l/liboath-2.4.1-9.el7.x86_64.rpm
# 抽取Binary Package
$ rpm2cpio liboath-2.4.1-9.el7.x86_64.rpm | cpio -ivd
./etc/liboath
./usr/lib64/liboath.so.0
./usr/lib64/liboath.so.0.1.3
./usr/share/doc/liboath-2.4.1
./usr/share/doc/liboath-2.4.1/COPYING
# 查看liboath.so.0相依性，可看到皆滿足
$ ldd ./usr/lib64/liboath.so.0
        linux-vdso.so.1 =&gt;  (0x00002aaaaaaab000)
        libc.so.6 =&gt; /lib64/libc.so.6 (0x00002aaaaacdf000)
        /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
</code></pre></td></tr></table>
</div>
</div><p>到這一步oathtool仍然找不到liboath.so.0，我們也無法把liboath.so.0所在的資料夾加入/etc/ld.so.conf的定義，所以我們要定義一個oathtool.sh腳本，腳本會自動新增LD_LIBRARY_PATH，告訴oathtool要去哪裡找我們剛剛下載的liboath.so.0：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">##### oathtool.sh #####</span>
<span class="c1">#!/bin/bash</span>
<span class="nv">oathtool</span><span class="o">=</span><span class="s2">&#34;/path/to/oathtool&#34;</span>
<span class="nv">ldPath</span><span class="o">=</span><span class="k">$(</span>dirname <span class="k">$(</span>readlink -f <span class="si">${</span><span class="nv">oathtool</span><span class="si">}</span><span class="k">))</span><span class="s2">&#34;/../lib64&#34;</span>
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH_OLD</span><span class="o">=</span><span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="si">}</span>
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">ldPath</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="si">}</span><span class="s2">&#34;</span>
<span class="si">${</span><span class="nv">oathtool</span><span class="si">}</span> <span class="nv">$@</span>
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">LD_LIBRARY_PATH_OLD</span><span class="si">}</span>
</code></pre></td></tr></table>
</div>
</div><p>現在oathtool.sh表現得就跟oathtool一樣了，以下測試：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">$ ./oathtool.sh
oathtool 2.4.1

Generate and validate OATH one-time passwords.

Usage: oathtool [OPTIONS]... [KEY [OTP]]...

  -h, --help                    Print help and exit
  -V, --version                 Print version and exit
      --hotp                    use event-based HOTP mode  (default=on)
      --totp                    use time-variant TOTP mode  (default=off)
  -b, --base32                  use base32 encoding of KEY instead of hex
                                  (default=off)
  -c, --counter=COUNTER         HOTP counter value
  -s, --time-step-size=DURATION TOTP time-step duration  (default=`30s&#39;)
  -S, --start-time=TIME         when to start counting time steps for TOTP
                                  (default=`1970-01-01 00:00:00 UTC&#39;)
  -N, --now=TIME                use this time as current time for TOTP
                                  (default=`now&#39;)
  -d, --digits=DIGITS           number of digits in one-time password
  -w, --window=WIDTH            window of counter values to test when
                                  validating OTPs
  -v, --verbose                 explain what is being done  (default=off)

Report bugs to: oath-toolkit-help@nongnu.org
oathtool home page: 
General help using GNU software: 
</code></pre></td></tr></table>
</div>
</div><h2 id="aptdebianubuntu系統">apt(Debian/Ubuntu)系統</h2>
<p>查詢作業系統版本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">$ lsb_release -d
Description:    Ubuntu 18.04.1 LTS
</code></pre></td></tr></table>
</div>
</div><p>到<a href="https://pkgs.org/download">pkgs.org</a>找相應的Binary Package apt版本，我們點選Ubuntu 18.04 LTS (Bionic Beaver)的Ubuntu Universe amd64版本oathtool_2.6.1-1_amd64.deb ( BSD Linux家族把x86-64架構稱為AMD64，目前幾乎所有的伺服器架構都是x86_64 )，接著在Download底下取得Binary Package的下載連結，以下面的指令下載、展開、確認相依性：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"># 先下載oathtool
$ wget http://archive.ubuntu.com/ubuntu/pool/universe/o/oath-toolkit/oathtool_2.6.1-1_amd64.deb
# 抽取oathtool到特定資料夾oathtool內
$ dpkg -X oathtool_2.6.1-1_amd64.deb ./oathtool
./
./usr/
./usr/share/
./usr/share/doc/
./usr/share/doc/oathtool/
./usr/share/doc/oathtool/copyright
./usr/share/man/
./usr/share/man/man1/
./usr/share/man/man1/oathtool.1.gz
./usr/bin/
./usr/bin/oathtool
./usr/share/doc/oathtool/AUTHORS
./usr/share/doc/oathtool/README
./usr/share/doc/oathtool/NEWS.gz
./usr/share/doc/oathtool/changelog.Debian.gz
# 查看oathtool相依性
$ ldd ./oath/usr/bin/oathtool
        linux-vdso.so.1 (0x00007fff10bfe000)
        liboath.so.0 =&gt; not found
        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fda6c3ea000)
        /lib64/ld-linux-x86-64.so.2 (0x00007fda6c7db000)
# 取得、抽取未滿足的相依性libc.so.6
$ wget http://archive.ubuntu.com/ubuntu/pool/universe/o/oath-toolkit/liboath0_2.6.1-1_amd64.deb
$ dpkg -X liboath0_2.6.1-1_amd64.deb ./oathtool
./
./usr/
./usr/share/
./usr/share/doc/
./usr/share/doc/liboath0/
./usr/share/doc/liboath0/AUTHORS
./usr/share/doc/liboath0/README
./usr/share/doc/liboath0/copyright
./usr/share/doc/liboath0/NEWS.gz
./usr/share/doc/liboath0/changelog.Debian.gz
./usr/lib/
./usr/lib/liboath.so.0.1.3
./usr/lib/liboath.so.0
# 檢查libc.so.6是否滿足
$ ldd ./oath/usr/lib/liboath.so.0
        linux-vdso.so.1 (0x00007ffc0f0f5000)
        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f8f6da78000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f8f6e07d000)
</code></pre></td></tr></table>
</div>
</div><p>到這一步oathtool仍然找不到libc.so.6，我們也無法把libc.so.6所在的資料夾加入/etc/ld.so.conf的定義，所以我們要定義一個oathtool.sh腳本，腳本會自動新增LD_LIBRARY_PATH，告訴oathtool要去哪裡找我們剛剛下載的libc.so.6：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">##### oathtool.sh #####</span>
<span class="c1">#!/bin/bash</span>
<span class="nv">oathtool</span><span class="o">=</span><span class="s2">&#34;/path/to/oathtool&#34;</span>
<span class="nv">ldPath</span><span class="o">=</span><span class="k">$(</span>dirname <span class="k">$(</span>readlink -f <span class="si">${</span><span class="nv">oathtool</span><span class="si">}</span><span class="k">))</span><span class="s2">&#34;/../lib&#34;</span>
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH_OLD</span><span class="o">=</span><span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="si">}</span>
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">ldPath</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="si">}</span><span class="s2">&#34;</span>
<span class="si">${</span><span class="nv">oathtool</span><span class="si">}</span> <span class="nv">$@</span>
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">LD_LIBRARY_PATH_OLD</span><span class="si">}</span>
</code></pre></td></tr></table>
</div>
</div><p>現在oathtool.sh表現得就跟oathtool一樣了，以下測試：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">$ ./oathtool/usr/bin/oathtool.sh
oathtool 2.6.1

Generate and validate OATH one-time passwords.

Usage: oathtool [OPTIONS]... [KEY [OTP]]...

  -h, --help                    Print help and exit
  -V, --version                 Print version and exit
      --hotp                    use event-based HOTP mode  (default=on)
      --totp[=STRING]           use time-variant TOTP mode  (possible
                                  values=&#34;sha1&#34;, &#34;sha256&#34;, &#34;sha512&#34;
                                  default=`sha1&#39;)
  -b, --base32                  use base32 encoding of KEY instead of hex
                                  (default=off)
  -c, --counter=COUNTER         HOTP counter value
  -s, --time-step-size=DURATION TOTP time-step duration  (default=`30s&#39;)
  -S, --start-time=TIME         when to start counting time steps for TOTP
                                  (default=`1970-01-01 00:00:00 UTC&#39;)
  -N, --now=TIME                use this time as current time for TOTP
                                  (default=`now&#39;)
  -d, --digits=DIGITS           number of digits in one-time password
  -w, --window=WIDTH            window of counter values to test when
                                  validating OTPs
  -v, --verbose                 explain what is being done  (default=off)

Report bugs to: oath-toolkit-help@nongnu.org
oathtool home page: 
General help using GNU software: 
</code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">tigernaxo</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2019-01-23
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E5%8F%B0%E7%81%A3%E6%9D%89/">台灣杉</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/javascript/array_functions/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">[JavaScript] Array 常用方法</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
      </nav>
    </footer>
  </article>
        </div>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-3218529224055685"
     data-ad-slot="9801139998"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:tigernaxo.co.cc@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://www.linkedin.com/in/%E8%AD%BD%E6%99%9F-%E9%99%B3-41464a132/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/tigernaxo" class="iconfont icon-github" title="github"></a>
  <a href="https://blogger.tigernaxo.com/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由靜態頁面產生器 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 驅動
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主題 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>tigernaxo</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-169120579-2', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3218529224055685"
     data-ad-slot="8466725642"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>



</body>
</html>
